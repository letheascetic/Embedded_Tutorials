# CAN -- Controller Area Network

* robust vehicle bus standard
* message-based protocol

### references

* https://en.wikipedia.org/wiki/CAN_bus

### CAN总线是什么

CAN是一种消息协议，1983年由德国公司Bosch开发。CAN是一种电子设备之间的通讯协议，包含了硬件和软件两方面的规定，类似于RS-232、USB、以太网等。
他们都只是一种“线”。如果你不想要知道太多，那么只需要知道仪器用CAN线连在一起，他们之间就可以交换信息了。

CAN主要应用于汽车领域，开发的初衷之一正是统一车辆内各电子设备的通讯，精简复杂的线束。

CAN总线标准主要在ISO 11898这个文档里，此外还有Bosch的CAN 2.0。大致上可以分为“硬件结构是什么样”和“如何交换数据”两部分。

### 硬件结构是什么样

CAN是一种总线，也就是说所有的设备（以下称为节点，Node）都接在同一条线上。所有节点可以（尽管不应该）同时操作总线。

CAN是串行的，一般只需要3根线：**CAN_H、CAN_L、GND**，没有时钟。CAN_H与CAN_L差分传送数据，物理上应该双绞，而GND做线壳。电压不定，一般来说5V电源时，要表示0，CAN_H和CAN_L都是2.5V；表示1，CAN_H是3.5V，CAN_L是1.5V。

CAN线在物理上实现了“线与(wired-AND)”的连接方式——任何一个节点输出0，总线即为0。

### 如何交换数据

设备之间不分主从，任何设备（节点）都可以操作总线来发送消息，而此时另外的所有节点会收到这条消息。至于收到的消息有没有用，怎么用，由节点自行处理。

总线通讯不区分主从节点，就可能会出现冲突：尽管节点只应该在总线空闲时才发送消息，但仍可能会非常巧，有2个或以上的节点同时想要操作总线发送消息。这时需要“仲裁”，到底应该谁来发送。

仲裁利用了“线与”：在任何消息之前附加11位ID，ID决定了消息的优先度，小为优先度高。任何节点在发送消息ID（写总线）时也回读结果，如果发现和自己写的不一样，节点就知道还有别的节点在发送数据，并且自己发送的消息优先度更低，于是放弃操作总线。

    举个例子：
    Node1:  00001000000
    Node2:  000011*****
    CANBUS: 00001000000

