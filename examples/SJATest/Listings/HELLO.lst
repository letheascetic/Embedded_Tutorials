C51 COMPILER V9.57.0.0   HELLO                                                             07/13/2018 14:58:29 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE HELLO
OBJECT MODULE PLACED IN .\Objects\HELLO.obj
COMPILER INVOKED BY: D:\Keil\Keil_v5\C51\BIN\C51.EXE HELLO.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\HELLO.lst) OBJECT(.\Objects\HELLO.obj)

line level    source

   1          /*------------------------------------------------------------------------------
   2          HELLO.C
   3          Copyright 1995-2005 Keil Software, Inc.
   4          ------------------------------------------------------------------------------*/
   5           
   6          #include <REG52.H>                /* special function register declarations   */
   7                                            /* for the intended 8051 derivative         */
   8           
   9          #include <stdio.h>                /* prototype declarations for I/O functions */
  10          #include "sja1000_reg.h"                  /* sja1000Tçš„å¯„å­˜å™¨å®šä¹‰æ–‡ä»¶*/
  11          #include <absacc.h>                               /* ä¸»è¦æ˜¯ç”¨äºå¯»å€å¤–éƒ¨å­˜å‚¨å™¨*/
  12           
  13          sbit SJARst = P2^6;                       //å¤ä½æ§åˆ¶     
  14          
  15          void SJA1000_Tx_Display(void)
  16          {
  17   1              printf( " TBSR3 = 0x%x \n", REG_TxBufferRd3 );  
  18   1              printf( " TBSR4 = 0x%x \n", REG_TxBufferRd4 );  
  19   1              printf( " TBSR5 = 0x%x \n", REG_TxBufferRd5 );  
  20   1              printf( " TBSR6 = 0x%x \n", REG_TxBufferRd6 );  
  21   1              printf( " TBSR7 = 0x%x \n", REG_TxBufferRd7 );  
  22   1              printf( " TBSR8 = 0x%x \n", REG_TxBufferRd8 );  
  23   1              printf( " TBSR9 = 0x%x \n", REG_TxBufferRd9 );  
  24   1              printf( " TBSR10 = 0x%x \n",REG_TxBufferRd10);  
  25   1      }
  26          /*æ˜¾ç¤ºå‘é€çš„ä¿¡æ¯,ä¹‹å‰ç›´æ¥ä½¿ç”¨å‘é€ç¼“å†²åŒºï¼Œè¿™ç§æ–¹æ³•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º0x10å¼€å§‹çš„
             -13ä¸ªå¯„å­˜å™¨ï¼Œè¯»çš„æ—¶å€™æ˜¯æ¥æ”¶ç¼“å†²åŒºï¼Œå†™çš„æ—¶å€™æ˜¯å‘é€ç¼“å†²åŒº*/
  27           
  28          void SJA_Init(void)                          
  29          {    
  30   1              //SJA1000å¤ä½                                        
  31   1               unsigned char i;                            
  32   1               for(i = 0;i < 125;i++);           
  33   1               SJARst = 0;                                 
  34   1               for(i = 0;i < 125;i++);//ç»™RSTå¼•è„šä¸€ä¸ªä½è„‰å†²
  35   1               SJARst = 1;                                 
  36   1               for(i = 0;i < 125;i++);                     
  37   1      }  
  38          
  39          void SJA1000_TxData(void)
  40          {
  41   1              while(REG_SR & 0x10);           //å½“SJA1000ä¸å¤„äºæ¥æ”¶çŠ¶æ€æ—¶æ‰å¯ç»§ç»­æ‰§è¡Œï¼ŒSR.4==0x1ï¼Œæ­£åœ¨æ¥æ”¶ï
             -¼Œç­‰å¾…
  42   1          while(!(REG_SR & 0x08));    //SR.3=0,å‘é€è¯·æ±‚æœªå¤„ç†å®Œï¼Œç­‰å¾…ç›´åˆ°SR.3=1
  43   1          while(!(REG_SR & 0x04));    //SR.2=0,å‘é€ç¼“å†²å™¨è¢«é”ã€‚ç­‰å¾…ç›´åˆ°SR.2=1   
  44   1              
  45   1              REG_TxBuffer0 = 0x08;//å¸§ä¿¡æ¯,æ ‡å‡†å¸§ï¼Œæ•°æ®å¸§ï¼Œ8å­—èŠ‚        
  46   1                                                                         
  47   1              REG_TxBuffer1 = 0xEA;//æ ‡è¯†ç¬¦1                             
  48   1              REG_TxBuffer2 = 0x60;//æ ‡è¯†ç¬¦2                     
  49   1                                                               
  50   1              REG_TxBuffer3 = 0x11;//å‘é€æ•°æ®ä½ï¼š1                       
  51   1              REG_TxBuffer4 = 0x22;//å‘é€æ•°æ®ä½ï¼š2                       
  52   1              REG_TxBuffer5 = 0x33;                                      
C51 COMPILER V9.57.0.0   HELLO                                                             07/13/2018 14:58:29 PAGE 2   

  53   1              REG_TxBuffer6 = 0x44;                                      
  54   1              REG_TxBuffer7 = 0x55;                                      
  55   1              REG_TxBuffer8 = 0x66;                                      
  56   1              REG_TxBuffer9 = 0x77;                                      
  57   1              REG_TxBuffer10 = 0x88;//here Over                          
  58   1                                   
  59   1              SJA1000_Tx_Display();
  60   1              REG_CMD = 0x12;                         //è‡ªæ¥æ”¶
  61   1              while(!(REG_SR & 0x08));        //æ£€æµ‹å‘é€å®Œæ¯•    
  62   1      }
  63          
  64          /*------------------------------------------------
  65          The main C function.  Program execution starts
  66          here after stack initialization.
  67          ------------------------------------------------*/
  68          void main (void) 
  69          {
  70   1       
  71   1      /*------------------------------------------------
  72   1      Setup the serial port for 9600 baud at 11.0592MHz.
  73   1      ------------------------------------------------*/
  74   1          SCON  = 0x50;                       /* SCON: mode 1, 8-bit UART, enable rcvr      */
  75   1          TMOD |= 0x20;               /* TMOD: timer 1, mode 2, 8-bit reload        */
  76   1          TH1   = 0xFD;               /* TH1:  reload value for 9600 baud @ 11.0595MHZ   */
  77   1          TR1   = 1;                  /* TR1:  timer 1 run                          */
  78   1          TI    = 1;                  /* TI:   set TI to send first char of UART    */
  79   1              PX0=1;                                          //å¤–éƒ¨ä¸­æ–­0é«˜ä¼˜å…ˆçº§
  80   1              IT0=1;                                          //è®¾ç½®INT0ä¸ºä¸‹é™æ²¿ä¸­æ–­
  81   1              EX0=1;                                          //ä½¿èƒ½INT0ä¸­æ–­
  82   1       
  83   1      /*------------------------------------------------
  84   1      Note that an embedded program never exits (because
  85   1      there is no operating system to return to).  It
  86   1      must loop and execute forever.
  87   1      ------------------------------------------------*/
  88   1         
  89   1          printf ("Hello World\n");   /* Print "Hello World" */
  90   1              SJA_Init();//ä¸»è¦æ˜¯ä½¿èŠ¯ç‰‡å¤ä½
  91   1              /*
  92   1                      Enter the reset Mode
  93   1              */
  94   1              REG_MODE = 0x01; 
  95   1              while((REG_MODE&0x01)!= 0x01);  //ç¡®å®šè¿›å…¥å¤ä½æ¨¡å¼ 
  96   1              printf("1.Enter the Reset Mode,REG_MODE=0x%x\n",REG_MODE);
  97   1                    
  98   1              REG_CDR = 0xc8;         //è®¾ç½®æ—¶é’Ÿåˆ†é¢‘å¯„å­˜å™¨ã€‚CDR.7 = 1,PeliCANæ¨¡å¼ï¼›CDR.6ï¼ˆRX0æ¿€æ´»ï¼Œå…³é—­RX1ï
             -¼‰  fCLKOUT = fOSC/2, CDR.3(Close the CLKOUT)
  99   1              REG_RBSA = 0x00;        //RXç¼“å†²å™¨èµ·å§‹åœ°å€
 100   1                         
 101   1              /* Configure acceptance code and mask register */                                                            
 102   1              REG_ACR0 = 0xff;        //éªŒæ”¶ç å¯„å­˜å™¨                       
 103   1          REG_ACR1 = 0xff;                            
 104   1              REG_ACR2 = 0xff;                            
 105   1              REG_ACR3 = 0xff;                            
 106   1                                                                   
 107   1              REG_AMR0 = 0xff;        //éªŒæ”¶å±è”½å¯„å­˜å™¨ï¼Œæ¥æ”¶ä»»ä½•æ ‡è¯†ç¬¦çš„æ•°æ®åŒ…         
 108   1              REG_AMR1 = 0xff;                            
 109   1              REG_AMR2 = 0xff;                            
 110   1              REG_AMR3 = 0xff;    
 111   1                                      
 112   1       
 113   1              /*configure bus timing registers*/
C51 COMPILER V9.57.0.0   HELLO                                                             07/13/2018 14:58:29 PAGE 3   

 114   1              REG_BTR0 = 0x00;                            
 115   1              REG_BTR1 = 0x14;        //100k     
 116   1                                                  
 117   1              REG_IR_ABLE = 0x01;     //Peliæ¨¡å¼ä¸­æ–­ä½¿èƒ½,æ¥æ”¶ä¸­æ–­ä½¿èƒ½ï¼Œå‘é€ä¸­æ–­ç¦æ­¢                  
 118   1          
 119   1              REG_OCR = 0x1a;         //è®¾ç½®è¾“å‡ºæ¨¡å¼ï¼šæ­£å¸¸è¾“å‡ºï¼Œä»TX0å£è¾“å‡º;TX1æ‚¬ç©º
 120   1                                                    
 121   1              REG_MODE = 0x0c;        //è¿›å…¥è‡ªæ¥æ”¶æ¨¡å¼.CDR.3(é€‰æ‹©å•ä¸ªéªŒæ”¶æ»¤æ³¢å™¨),CDR.2 (æ­¤æ¨¡å¼å¯ä»¥æ£€æµ‹
             -æ‰€æœ‰èŠ‚ç‚¹)
 122   1       
 123   1              while(REG_MODE != 0x0c);//ç¡®å®šè¿›å…¥è‡ªæ¥æ”¶æ¨¡å¼ä¸‹
 124   1              printf("2.Enter the self-test Mode,REG_MODE=0x%x\n",REG_MODE);
 125   1       
 126   1              SJA1000_TxData();//å‘é€æ•°æ®
 127   1              printf("\n\n");
 128   1              //SJA1000_Rx_Display();//æ¥æ”¶æ•°æ®å±•ç¤º
 129   1              EA = 1;//ä½¿èƒ½å…¨å±€ä¸­æ–­
 130   1              while(1);
 131   1      }
 132          
 133          /************************************************************
 134                          å‡½æ•°ï¼šex0_int 
 135                          è¯´æ˜ï¼šä¸­æ–­æœåŠ¡ç¨‹åº
 136                          å…¥å£ï¼šæ— 
 137                          è¿”å›ï¼šæ— 
 138          ***********************************************************/
 139          void handle_int(void) interrupt 0 using 1
 140          {
 141   1              if(REG_IR & 0x01)      //äº§ç”Ÿäº†æ¥æ”¶ä¸­æ–­
 142   1              { 
 143   2                      #pragma disable
 144   2                      printf( " Received message.\n");
 145   2                      printf( " RBSR3 = %x \n", REG_RxBuffer3 );
 146   2                      printf( " RBSR4 = %x \n", REG_RxBuffer4 );
 147   2                      printf( " RBSR5 = %x \n", REG_RxBuffer5 );     
 148   2                      printf( " RBSR6 = %x \n", REG_RxBuffer6 );     
 149   2                      printf( " RBSR7 = %x \n", REG_RxBuffer7 );     
 150   2                      printf( " RBSR8 = %x \n", REG_RxBuffer8 );     
 151   2                      printf( " RBSR9 = %x \n", REG_RxBuffer9 );     
 152   2                      printf( " RBSR10 = %x \n",REG_RxBuffer10);   
 153   2              }  
 154   1      }
*** WARNING C316 IN LINE 154 OF HELLO.c: unterminated conditionals


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    539    ----
   CONSTANT SIZE    =    358    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
